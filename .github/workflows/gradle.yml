name: Upload Generated File to Azure Blob (Linux)

on:
  workflow_dispatch

jobs:
  upload-to-blob:
    runs-on: ubuntu-latest

    steps:
      - name: Install Azure CLI
        run: |
          curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

      - name: Check Azure CLI version
        run: az version

      - name: Generate hello.txt
        run: |
          echo "Hello from GitHub Actions!" > hello.txt

      - name: Upload file using Azure CLI azcopy
        run: |
          echo "Uploading hello.txt to Azure Blob..."
          az storage azcopy blob upload \
            -s hello.txt \
            --destination "drivers/Chrome/beta/hello.txt" \
            -c windows \
            --connection-string ${{ secrets.PROD_HYP_MSFT_CONNECTION_STRING }} \
            --recursive

          if [[ $? -ne 0 ]]; then
            echo "Upload failed"
            exit 1
          else
            echo "Upload succeeded"
          fi
